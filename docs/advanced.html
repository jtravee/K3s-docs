<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advanced/advanced">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<title data-rh="true">Advanced Options and Configuration | K3s</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://k3s-io.github.io/docs/docs/advanced"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advanced Options and Configuration | K3s"><meta data-rh="true" name="description" content="This section contains advanced information describing the different ways you can run and manage K3s:"><meta data-rh="true" property="og:description" content="This section contains advanced information describing the different ways you can run and manage K3s:"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://k3s-io.github.io/docs/docs/advanced"><link data-rh="true" rel="alternate" href="https://k3s-io.github.io/docs/docs/advanced" hreflang="en"><link data-rh="true" rel="alternate" href="https://k3s-io.github.io/docs/docs/advanced" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.b6141f38.css">
<link rel="preload" href="/docs/assets/js/runtime~main.33e19d74.js" as="script">
<link rel="preload" href="/docs/assets/js/main.4c2ff82a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/k3s-logo-light.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/k3s-logo-dark.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/docs/docs">Docs</a><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs">K3s - Lightweight Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/quick-start">Quick-Start Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/docs/installation">Installation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/cluster-access">Cluster Access</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/docs/upgrades">Upgrades</a><button aria-label="Toggle the collapsible sidebar category &#x27;Upgrades&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/backup-restore">Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/storage">Volumes and Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/networking">Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/helm">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/docs/advanced">Advanced Options and Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/faq">FAQ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/docs/reference/server-config">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/known-issues">Known Issues</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/docs/security">Security</a><button aria-label="Toggle the collapsible sidebar category &#x27;Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Advanced Options and Configuration</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Advanced Options and Configuration</h1></header><p>This section contains advanced information describing the different ways you can run and manage K3s:</p><ul><li><a href="#certificate-rotation">Certificate rotation</a></li><li><a href="#auto-deploying-manifests">Auto-deploying manifests</a></li><li><a href="#using-docker-as-the-container-runtime">Using Docker as the container runtime</a></li><li><a href="#using-etcdctl">Using etcdctl</a></li><li><a href="#configuring-containerd">Configuring containerd</a></li><li><a href="#running-k3s-with-rootless-mode-experimental">Running K3s with Rootless mode (Experimental)</a></li><li><a href="#node-labels-and-taints">Node labels and taints</a></li><li><a href="#starting-the-server-with-the-installation-script">Starting the server with the installation script</a></li><li><a href="#additional-os-preparations">Additional OS preparations</a></li><li><a href="#additional-preparation-for-red-hatcentos-enterprise-linux">Additional preparation for (Red Hat/CentOS) Enterprise Linux</a></li><li><a href="#additional-preparation-for-raspberry-pi-os">Additional preparation for Raspberry Pi OS</a></li><li><a href="#enabling-vxlan-for-ubuntu-21.10+-on-raspberry-pi">Enabling vxlan on Ubuntu 21.10+ on Raspberry Pi</a></li><li><a href="#running-k3s-in-docker">Running K3s in Docker</a></li><li><a href="#selinux-support">SELinux Support</a></li><li><a href="#enabling-lazy-pulling-of-estargz-experimental">Enabling Lazy Pulling of eStargz (Experimental)</a></li><li><a href="#additional-logging-sources">Additional Logging Sources</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="certificate-rotation">Certificate Rotation<a class="hash-link" href="#certificate-rotation" title="Direct link to heading">​</a></h2><p>By default, certificates in K3s expire in 12 months.</p><p>If the certificates are expired or have fewer than 90 days remaining before they expire, the certificates are rotated when K3s is restarted.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-deploying-manifests">Auto-Deploying Manifests<a class="hash-link" href="#auto-deploying-manifests" title="Direct link to heading">​</a></h2><p>Any file found in <code>/var/lib/rancher/k3s/server/manifests</code> will automatically be deployed to Kubernetes in a manner similar to <code>kubectl apply</code>, both on startup and when the file is changed on disk. Deleting files out of this directory will not delete the corresponding resources from the cluster.</p><p>For information about deploying Helm charts, refer to the section about <a href="/docs/docs/helm">Helm.</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-docker-as-the-container-runtime">Using Docker as the Container Runtime<a class="hash-link" href="#using-docker-as-the-container-runtime" title="Direct link to heading">​</a></h2><p>K3s includes and defaults to <a href="https://containerd.io/" target="_blank" rel="noopener noreferrer">containerd,</a> an industry-standard container runtime.</p><p>To use Docker instead of containerd,</p><ol><li><p>Install Docker on the K3s node. One of Rancher&#x27;s <a href="https://github.com/rancher/install-docker" target="_blank" rel="noopener noreferrer">Docker installation scripts</a> can be used to install Docker:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> https://releases.rancher.com/install-docker/19.03.sh </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Install K3s using the <code>--docker</code> option:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -sfL https://get.k3s.io </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sh</span><span class="token plain"> -s - --docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm that the cluster is available:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> k3s kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAMESPACE     NAME                                     READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   local-path-provisioner-6d59f47c7-lncxn   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   metrics-server-7566d596c8-9tnck          </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   helm-install-traefik-mbkn9               </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">/1     Completed   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-8655855d6-rtbnb                  </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   svclb-traefik-jbmvl                      </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">/2     Running     </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          43s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   traefik-758cd5fc85-2wz97                 </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running     </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          43s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm that the Docker containers are running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINER ID        IMAGE                     COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3e4d34729602        897ce3c5fc8f              </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;entry&quot;</span><span class="token plain">                  About a minute ago   Up About a minute                       k8s_lb-port-443_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bffdc9d7a65f        rancher/klipper-lb        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;entry&quot;</span><span class="token plain">                  About a minute ago   Up About a minute                       k8s_lb-port-80_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">436b85c5e38d        rancher/library-traefik   </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/traefik --configfi…&quot;</span><span class="token plain">   About a minute ago   Up About a minute                       k8s_traefik_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">de8fded06188        rancher/pause:3.1         </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/pause&quot;</span><span class="token plain">                 About a minute ago   Up About a minute                       k8s_POD_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7c6a30aeeb2f        rancher/pause:3.1         </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/pause&quot;</span><span class="token plain">                 About a minute ago   Up About a minute                       k8s_POD_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ae6c58cab4a7        9d12f9848b99              </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;local-path-provisio…&quot;</span><span class="token plain">   About a minute ago   Up About a minute                       k8s_local-path-provisioner_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">be1450e1a11e        9dd718864ce6              </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/metrics-server&quot;</span><span class="token plain">        About a minute ago   Up About a minute                       k8s_metrics-server_metrics-server-7566d596c8-9tnck_kube-system_031e74b5-e9ef-47ef-a88d-fbf3f726cbc6_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4454d14e4d3f        c4d3d16fe508              </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/coredns -conf /etc…&quot;</span><span class="token plain">   About a minute ago   Up About a minute                       k8s_coredns_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c3675b87f96c        rancher/pause:3.1         </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/pause&quot;</span><span class="token plain">                 About a minute ago   Up About a minute                       k8s_POD_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4b1fddbe6ca6        rancher/pause:3.1         </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/pause&quot;</span><span class="token plain">                 About a minute ago   Up About a minute                       k8s_POD_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64d3517d4a95        rancher/pause:3.1         </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/pause&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="optional-use-crictl-with-docker">Optional: Use crictl with Docker<a class="hash-link" href="#optional-use-crictl-with-docker" title="Direct link to heading">​</a></h4><p>crictl provides a CLI for CRI-compatible container runtimes.</p><p>If you would like to use crictl after installing K3s with the <code>--docker</code> option, install crictl using the <a href="https://github.com/kubernetes-sigs/cri-tools/blob/master/docs/crictl.md" target="_blank" rel="noopener noreferrer">official documentation:</a> </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">VERSION</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v1.17.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -L https://github.com/kubernetes-sigs/cri-tools/releases/download/</span><span class="token variable" style="color:rgb(191, 199, 213)">$VERSION</span><span class="token plain">/crictl-</span><span class="token variable" style="color:rgb(191, 199, 213)">${VERSION}</span><span class="token plain">-linux-amd64.tar.gz --output crictl-</span><span class="token variable" style="color:rgb(191, 199, 213)">${VERSION}</span><span class="token plain">-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> zxvf crictl-</span><span class="token variable" style="color:rgb(191, 199, 213)">$VERSION</span><span class="token plain">-linux-amd64.tar.gz -C /usr/local/bin/crictl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then start using crictl commands:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> crictl version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Version:  </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RuntimeName:  </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RuntimeVersion:  </span><span class="token number" style="color:rgb(247, 140, 108)">19.03</span><span class="token plain">.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RuntimeApiVersion:  </span><span class="token number" style="color:rgb(247, 140, 108)">1.40</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> crictl images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMAGE                            TAG                 IMAGE ID            SIZE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/coredns-coredns          </span><span class="token number" style="color:rgb(247, 140, 108)">1.6</span><span class="token plain">.3               c4d3d16fe508b       </span><span class="token number" style="color:rgb(247, 140, 108)">44</span><span class="token plain">.3MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/klipper-helm             v0.2.5              6207e2a3f5225       136MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/klipper-lb               v0.1.2              897ce3c5fc8ff       </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">.1MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/library-traefik          </span><span class="token number" style="color:rgb(247, 140, 108)">1.7</span><span class="token plain">.19              aa764f7db3051       </span><span class="token number" style="color:rgb(247, 140, 108)">85</span><span class="token plain">.7MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/local-path-provisioner   v0.0.11             9d12f9848b99f       </span><span class="token number" style="color:rgb(247, 140, 108)">36</span><span class="token plain">.2MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/metrics-server           v0.3.6              9dd718864ce61       </span><span class="token number" style="color:rgb(247, 140, 108)">39</span><span class="token plain">.9MB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rancher/pause                    </span><span class="token number" style="color:rgb(247, 140, 108)">3.1</span><span class="token plain">                 da86e6ba6ca19       742kB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-etcdctl">Using etcdctl<a class="hash-link" href="#using-etcdctl" title="Direct link to heading">​</a></h2><p>etcdctl provides a CLI for etcd.</p><p>If you would like to use etcdctl after installing K3s with embedded etcd, install etcdctl using the <a href="https://etcd.io/docs/latest/install/" target="_blank" rel="noopener noreferrer">official documentation.</a> </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">VERSION</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v3.5.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -L https://github.com/etcd-io/etcd/releases/download/</span><span class="token variable" style="color:rgb(191, 199, 213)">${VERSION}</span><span class="token plain">/etcd-</span><span class="token variable" style="color:rgb(191, 199, 213)">${VERSION}</span><span class="token plain">-linux-amd64.tar.gz --output etcdctl-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -zxvf etcdctl-linux-amd64.tar.gz --strip-components</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> -C /usr/local/bin etcd-</span><span class="token variable" style="color:rgb(191, 199, 213)">${VERSION}</span><span class="token plain">-linux-amd64/etcdctl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then start using etcdctl commands with the appropriate K3s flags:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> etcdctl --cacert</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt --cert</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/var/lib/rancher/k3s/server/tls/etcd/client.crt --key</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/var/lib/rancher/k3s/server/tls/etcd/client.key version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-containerd">Configuring containerd<a class="hash-link" href="#configuring-containerd" title="Direct link to heading">​</a></h2><p>K3s will generate config.toml for containerd in <code>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</code>.</p><p>For advanced customization for this file you can create another file called <code>config.toml.tmpl</code> in the same directory and it will be used instead.</p><p>The <code>config.toml.tmpl</code> will be treated as a Go template file, and the <code>config.Node</code> structure is being passed to the template. See <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates" target="_blank" rel="noopener noreferrer">this folder</a> for Linux and Windows examples on how to use the structure to customize the configuration file.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-k3s-with-rootless-mode-experimental">Running K3s with Rootless mode (Experimental)<a class="hash-link" href="#running-k3s-with-rootless-mode-experimental" title="Direct link to heading">​</a></h2><blockquote><p><strong>Warning:</strong> This feature is experimental.</p></blockquote><p>Rootless mode allows running the entire k3s an unprivileged user, so as to protect the real root on the host from potential container-breakout attacks.</p><p>See also <a href="https://rootlesscontaine.rs/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/</a> to learn about Rootless mode.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="known-issues-with-rootless-mode">Known Issues with Rootless mode<a class="hash-link" href="#known-issues-with-rootless-mode" title="Direct link to heading">​</a></h3><ul><li><p><strong>Ports</strong></p><p>  When running rootless a new network namespace is created.  This means that K3s instance is running with networking fairly detached from the host.  The only way to access services run in K3s from the host is to set up port forwards to the K3s network namespace. We have a controller that will automatically bind 6443 and service port below 1024 to the host with an offset of 10000. </p><p>  That means service port 80 will become 10080 on the host, but 8080 will become 8080 without any offset.</p><p>  Currently, only <code>LoadBalancer</code> services are automatically bound.</p></li><li><p><strong>Cgroups</strong></p><p>  Cgroup v1 is not supported. v2 is supported.</p></li><li><p><strong>Multi-node cluster</strong></p><p>  Multi-cluster installation is untested and undocumented.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-servers-and-agents-with-rootless">Running Servers and Agents with Rootless<a class="hash-link" href="#running-servers-and-agents-with-rootless" title="Direct link to heading">​</a></h3><ul><li><p>Enable cgroup v2 delegation, see <a href="https://rootlesscontaine.rs/getting-started/common/cgroup2/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/getting-started/common/cgroup2/</a> .
This step is optional, but highly recommended for enabling CPU and memory resource limtitation.</p></li><li><p>Download <code>k3s-rootless.service</code> from <a href="https://github.com/k3s-io/k3s/blob/master/k3s-rootless.service" target="_blank" rel="noopener noreferrer"><code>https://github.com/k3s-io/k3s/blob/&lt;VERSION&gt;/k3s-rootless.service</code></a>.
Make sure to use the same version of <code>k3s-rootless.service</code> and <code>k3s</code>.</p></li><li><p>Install <code>k3s-rootless.service</code> to <code>~/.config/systemd/user/k3s-rootless.service</code>.
Installing this file as a system-wide service (<code>/etc/systemd/...</code>) is not supported.
Depending on the path of <code>k3s</code> binary, you might need to modify the <code>ExecStart=/usr/local/bin/k3s ...</code> line of the file.</p></li><li><p>Run <code>systemctl --user daemon-reload</code></p></li><li><p>Run <code>systemctl --user enable --now k3s-rootless</code></p></li><li><p>Run <code>KUBECONFIG=~/.kube/k3s.yaml kubectl get pods -A</code>, and make sure the pods are running.</p></li></ul><blockquote><p><strong>Note:</strong> Don&#x27;t try to run <code>k3s server --rootless</code> on a terminal, as it doesn&#x27;t enable cgroup v2 delegation.
If you really need to try it on a terminal, prepend <code>systemd-run --user -p Delegate=yes --tty</code> to create a systemd scope.</p><p>i.e., <code>systemd-run --user -p Delegate=yes --tty k3s server --rootless</code></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h3><ul><li>Run <code>systemctl --user status k3s-rootless</code> to check the daemon status</li><li>Run <code>journalctl --user -f -u k3s-rootless</code> to see the daemon log</li><li>See also <a href="https://rootlesscontaine.rs/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-labels-and-taints">Node Labels and Taints<a class="hash-link" href="#node-labels-and-taints" title="Direct link to heading">​</a></h2><p>K3s agents can be configured with the options <code>--node-label</code> and <code>--node-taint</code> which adds a label and taint to the kubelet. The two options only add labels and/or taints <a href="/docs/docs/reference/agent-config#node-labels-and-taints-for-agents">at registration time,</a> so they can only be added once and not changed after that again by running K3s commands.</p><p>If you want to change node labels and taints after node registration you should use <code>kubectl</code>. Refer to the official Kubernetes documentation for details on how to add <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener noreferrer">taints</a> and <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node" target="_blank" rel="noopener noreferrer">node labels.</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-the-server-with-the-installation-script">Starting the Server with the Installation Script<a class="hash-link" href="#starting-the-server-with-the-installation-script" title="Direct link to heading">​</a></h2><p>The installation script will auto-detect if your OS is using systemd or openrc and start the service.
When running with openrc, logs will be created at <code>/var/log/k3s.log</code>. </p><p>When running with systemd, logs will be created in <code>/var/log/syslog</code> and viewed using <code>journalctl -u k3s</code>.</p><p>An example of installing and auto-starting with the install script:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -sfL https://get.k3s.io </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sh</span><span class="token plain"> -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When running the server manually you should get an output similar to the following:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ k3s server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:19.908493986-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Starting k3s dev                             </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:19.908934479-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Running kube-apiserver --allow-privileged</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true --authorization-mode Node,RBAC --service-account-signing-key-file /var/lib/rancher/k3s/server/tls/service.key --service-cluster-ip-range </span><span class="token number" style="color:rgb(247, 140, 108)">10.43</span><span class="token plain">.0.0/16 --advertise-port </span><span class="token number" style="color:rgb(247, 140, 108)">6445</span><span class="token plain"> --advertise-address </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1 --insecure-port </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> --secure-port </span><span class="token number" style="color:rgb(247, 140, 108)">6444</span><span class="token plain"> --bind-address </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1 --tls-cert-file /var/lib/rancher/k3s/server/tls/localhost.crt --tls-private-key-file /var/lib/rancher/k3s/server/tls/localhost.key --service-account-key-file /var/lib/rancher/k3s/server/tls/service.key --service-account-issuer k3s --api-audiences unknown --basic-auth-file /var/lib/rancher/k3s/server/cred/passwd --kubelet-client-certificate /var/lib/rancher/k3s/server/tls/token-node.crt --kubelet-client-key /var/lib/rancher/k3s/server/tls/token-node.key </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Flag --insecure-port has been deprecated, This flag will be removed </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> a future version.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.196766005-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Running kube-scheduler --kubeconfig /var/lib/rancher/k3s/server/cred/kubeconfig-system.yaml --port </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> --secure-port </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> --leader-elect</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.196880841-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Running kube-controller-manager --kubeconfig /var/lib/rancher/k3s/server/cred/kubeconfig-system.yaml --service-account-private-key-file /var/lib/rancher/k3s/server/tls/service.key --allocate-node-cidrs --cluster-cidr </span><span class="token number" style="color:rgb(247, 140, 108)">10.42</span><span class="token plain">.0.0/16 --root-ca-file /var/lib/rancher/k3s/server/tls/token-ca.crt --port </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> --secure-port </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> --leader-elect</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">false </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Flag --port has been deprecated, see --secure-port instead.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.273441984-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Listening on :6443                           </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.278383446-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Writing manifest: /var/lib/rancher/k3s/server/manifests/coredns.yaml </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.474454524-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Node token is available at /var/lib/rancher/k3s/server/node-token </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.474471391-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> To </span><span class="token function" style="color:rgb(130, 170, 255)">join</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"> to cluster: k3s agent -s https://10.20.0.3:6443 -t </span><span class="token variable" style="color:rgb(191, 199, 213)">${NODE_TOKEN}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.541027133-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Wrote kubeconfig /etc/rancher/k3s/k3s.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-01-22T15:16:20.541049100-07:00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> Run: k3s kubectl                             </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output will likely be much longer as the agent will create a lot of logs. By default, the server
will register itself as a node (run the agent).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-os-preparations">Additional OS Preparations<a class="hash-link" href="#additional-os-preparations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-preparation-for-debian-buster-based-distributions">Additional preparation for Debian &quot;buster&quot; based distributions<a class="hash-link" href="#additional-preparation-for-debian-buster-based-distributions" title="Direct link to heading">​</a></h3><p>Several popular Linux distributions based on Debian &quot;buster&quot; ship a version of iptables between v1.8.0-v1.8.4. These versions contain a bug which causes the accumulation of duplicate rules, which negatively affects the performance and stability of the node. See <a href="https://github.com/k3s-io/k3s/issues/3117" target="_blank" rel="noopener noreferrer">Issue #3117</a> for more background. </p><p>Switching from nftables mode to legacy iptables mode will bypass this issue.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> iptables -F</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> update-alternatives --set iptables /usr/sbin/iptables-legacy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternatively, K3s ships which a working version of ipTables (v1.8.6) which functions properly. You can replace iptables on your system:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> remove iptables nftables -y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reboot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(130, 170, 255)">PATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/var/lib/rancher/k3s/data/current/bin/:/var/lib/rancher/k3s/data/current/bin/aux:</span><span class="token string environment constant" style="color:rgb(130, 170, 255)">$PATH</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>K3s will now use its packaged version of iptables.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">which</span><span class="token plain"> iptables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/var/lib/rancher/k3s/data/current/bin/aux/iptables</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-preparation-for-red-hatcentos-enterprise-linux">Additional preparation for (Red Hat/CentOS) Enterprise Linux<a class="hash-link" href="#additional-preparation-for-red-hatcentos-enterprise-linux" title="Direct link to heading">​</a></h3><p>It is recommended to turn off firewalld:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl disable firewalld --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If enabled, it is required to disable nm-cloud-setup and reboot the node:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl disable nm-cloud-setup.service nm-cloud-setup.timer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-preparation-for-raspberry-pi-os">Additional preparation for Raspberry Pi OS<a class="hash-link" href="#additional-preparation-for-raspberry-pi-os" title="Direct link to heading">​</a></h3><p>Raspberry Pi OS is Debian based, and may suffer from an old iptables version. See <a href="#additional-preparation-for-debian-buster-based-distributions">workarounds</a>.</p><p>Standard Raspberry Pi OS installations do not start with <code>cgroups</code> enabled. <strong>K3S</strong> needs <code>cgroups</code> to start the systemd service. <code>cgroups</code>can be enabled by appending <code>cgroup_memory=1 cgroup_enable=memory</code> to <code>/boot/cmdline.txt</code>.</p><p>Example cmdline.txt:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">console=serial0,115200 console=tty1 root=PARTUUID=58b06195-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait cgroup_memory=1 cgroup_enable=memory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-vxlan-for-ubuntu-2110-on-raspberry-pi">Enabling vxlan for Ubuntu 21.10+ on Raspberry Pi<a class="hash-link" href="#enabling-vxlan-for-ubuntu-2110-on-raspberry-pi" title="Direct link to heading">​</a></h2><p>Starting with Ubuntu 21.10, vxlan support on Raspberry Pi has been moved into a separate kernel module. </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> linux-modules-extra-raspi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-k3s-in-docker">Running K3s in Docker<a class="hash-link" href="#running-k3s-in-docker" title="Direct link to heading">​</a></h2><p>There are several ways to run K3s in Docker:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">K3d</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker Compose</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><a href="https://github.com/k3s-io/k3d" target="_blank" rel="noopener noreferrer">k3d</a> is a utility designed to easily run K3s in Docker.</p><p>It can be installed via the the <a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">brew</a> utility on MacOS:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> k3d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>A <code>docker-compose.yml</code> in the K3s repo serves as an <a href="https://github.com/k3s-io/k3s/blob/master/docker-compose.yml" target="_blank" rel="noopener noreferrer">example</a> of how to run K3s from Docker. To run <code>docker-compose</code> in this repo, run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up --scale </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">agent</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># kubeconfig is written to current dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl --kubeconfig kubeconfig.yaml get </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME           STATUS   ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">497278a2d6a2   Ready    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">   11s   v1.13.2-k3s2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">d54c8b17c055   Ready    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">   11s   v1.13.2-k3s2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">db7a5a5a5bdd   Ready    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">   12s   v1.13.2-k3s2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To only run the agent in Docker, use <code>docker-compose up agent</code>.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>To use Docker, <code>rancher/k3s</code> images are also available to run the K3s server and agent.
Using the <code>docker run</code> command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -d --tmpfs /run </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --tmpfs /var/run </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">K3S_URL</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">${SERVER_URL}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">K3S_TOKEN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">${NODE_TOKEN}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --privileged rancher/k3s:vX.Y.Z</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="selinux-support">SELinux Support<a class="hash-link" href="#selinux-support" title="Direct link to heading">​</a></h2><p><em>Supported as of v1.19.4+k3s1. Experimental as of v1.17.4+k3s1.</em></p><p>If you are installing K3s on a system where SELinux is enabled by default (such as CentOS), you must ensure the proper SELinux policies have been installed. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatic-installation">Automatic Installation<a class="hash-link" href="#automatic-installation" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Version Gate</div><div class="admonitionContent_S0QG"><p>Available as of v1.19.3+k3s2</p></div></div><p>The <a href="/docs/docs/installation/configuration#options-for-installation-with-script">install script</a> will automatically install the SELinux RPM from the Rancher RPM repository if on a compatible system if not performing an air-gapped install. Automatic installation can be skipped by setting <code>INSTALL_K3S_SKIP_SELINUX_RPM=true</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-installation">Manual Installation<a class="hash-link" href="#manual-installation" title="Direct link to heading">​</a></h3><p>The necessary policies can be installed with the following commands:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y container-selinux selinux-policy-base</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y https://rpm.rancher.io/k3s/latest/common/centos/7/noarch/k3s-selinux-0.2-1.el7_8.noarch.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To force the install script to log a warning rather than fail, you can set the following environment variable: <code>INSTALL_K3S_SELINUX_WARN=true</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-and-disabling-selinux-enforcement">Enabling and Disabling SELinux Enforcement<a class="hash-link" href="#enabling-and-disabling-selinux-enforcement" title="Direct link to heading">​</a></h3><p>The way that SELinux enforcement is enabled or disabled depends on the K3s version.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">K3s v1.19.1+k3s1</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">K3s before v1.19.1+k3s1</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6">To leverage SELinux, specify the `--selinux` flag when starting K3s servers and agents. This option can also be specified in the K3s [configuration file](#).<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">selinux: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>--disable-selinux</code> option should not be used. It is deprecated and will be either ignored or will be unrecognized, resulting in an error, in future minor releases.</p><p>Using a custom <code>--data-dir</code> under SELinux is not supported. To customize it, you would most likely need to write your own custom policy. For guidance, you could refer to the <a href="https://github.com/containers/container-selinux" target="_blank" rel="noopener noreferrer">containers/container-selinux</a> repository, which contains the SELinux policy files for Container Runtimes, and the <a href="https://github.com/rancher/k3s-selinux" target="_blank" rel="noopener noreferrer">rancher/k3s-selinux</a> repository, which contains the SELinux policy for K3s.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>SELinux is automatically enabled for the built-in containerd.</p><p>To turn off SELinux enforcement in the embedded containerd, launch K3s with the <code>--disable-selinux</code> flag.</p><p>Using a custom <code>--data-dir</code> under SELinux is not supported. To customize it, you would most likely need to write your own custom policy. For guidance, you could refer to the <a href="https://github.com/containers/container-selinux" target="_blank" rel="noopener noreferrer">containers/container-selinux</a> repository, which contains the SELinux policy files for Container Runtimes, and the <a href="https://github.com/rancher/k3s-selinux" target="_blank" rel="noopener noreferrer">rancher/k3s-selinux</a> repository, which contains the SELinux policy for K3s .</p></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-lazy-pulling-of-estargz-experimental">Enabling Lazy Pulling of eStargz (Experimental)<a class="hash-link" href="#enabling-lazy-pulling-of-estargz-experimental" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-lazy-pulling-and-estargz">What&#x27;s lazy pulling and eStargz?<a class="hash-link" href="#whats-lazy-pulling-and-estargz" title="Direct link to heading">​</a></h3><p>Pulling images is known as one of the time-consuming steps in the container lifecycle.
According to <a href="https://www.usenix.org/conference/fast16/technical-sessions/presentation/harter" target="_blank" rel="noopener noreferrer">Harter, et al.</a>,</p><blockquote><p>pulling packages accounts for 76% of container start time, but only 6.4% of that data is read</p></blockquote><p>To address this issue, k3s experimentally supports <em>lazy pulling</em> of image contents.
This allows k3s to start a container before the entire image has been pulled.
Instead, the necessary chunks of contents (e.g. individual files) are fetched on-demand.
Especially for large images, this technique can shorten the container startup latency.</p><p>To enable lazy pulling, the target image needs to be formatted as <a href="https://github.com/containerd/stargz-snapshotter/blob/main/docs/stargz-estargz.md" target="_blank" rel="noopener noreferrer"><em>eStargz</em></a>.
This is an OCI-alternative but 100% OCI-compatible image format for lazy pulling.
Because of the compatibility, eStargz can be pushed to standard container registries (e.g. ghcr.io) as well as this is <em>still runnable</em> even on eStargz-agnostic runtimes.</p><p>eStargz is developed based on the <a href="https://github.com/google/crfs" target="_blank" rel="noopener noreferrer">stargz format proposed by Google CRFS project</a> but comes with practical features including content verification and performance optimization.
For more details about lazy pulling and eStargz, please refer to <a href="https://github.com/containerd/stargz-snapshotter" target="_blank" rel="noopener noreferrer">Stargz Snapshotter project repository</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-k3s-for-lazy-pulling-of-estargz">Configure k3s for lazy pulling of eStargz<a class="hash-link" href="#configure-k3s-for-lazy-pulling-of-estargz" title="Direct link to heading">​</a></h3><p>As shown in the following, <code>--snapshotter=stargz</code> option is needed for k3s server and agent.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s server --snapshotter</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">stargz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this configuration, you can perform lazy pulling for eStargz-formatted images.
The following Pod manifest uses eStargz-formatted <code>node:13.13.0</code> image (<code>ghcr.io/stargz-containers/node:13.13.0-esgz</code>).
k3s performs lazy pulling for this image.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">estargz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ghcr.io/stargz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">containers/node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">13.13.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">esgz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;node&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> var http = require(&#x27;http&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      http.createServer(function(req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> res) </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        res.writeHead(200);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        res.end(&#x27;Hello World</span><span class="token tag" style="color:rgb(255, 85, 114)">!</span><span class="token plain">\n&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">).listen(80);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-logging-sources">Additional Logging Sources<a class="hash-link" href="#additional-logging-sources" title="Direct link to heading">​</a></h2><p><a href="https://rancher.com/docs/rancher/v2.6/en/logging/helm-chart-options/" target="_blank" rel="noopener noreferrer">Rancher logging</a> for K3s can be installed without using Rancher. The following instructions should be executed to do so:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> rancher-charts https://charts.rancher.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> --create-namespace -n cattle-logging-system rancher-logging-crd rancher-charts/rancher-logging-crd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> --create-namespace -n cattle-logging-system rancher-logging --set additionalLoggingSources.k3s.enabled</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true rancher-charts/rancher-logging</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/k3s-io/docs/edit/main/docs/advanced/advanced.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-08T16:43:42.000Z">Aug 8, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/docs/helm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Helm</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/docs/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#certificate-rotation" class="table-of-contents__link toc-highlight">Certificate Rotation</a></li><li><a href="#auto-deploying-manifests" class="table-of-contents__link toc-highlight">Auto-Deploying Manifests</a></li><li><a href="#using-docker-as-the-container-runtime" class="table-of-contents__link toc-highlight">Using Docker as the Container Runtime</a></li><li><a href="#using-etcdctl" class="table-of-contents__link toc-highlight">Using etcdctl</a></li><li><a href="#configuring-containerd" class="table-of-contents__link toc-highlight">Configuring containerd</a></li><li><a href="#running-k3s-with-rootless-mode-experimental" class="table-of-contents__link toc-highlight">Running K3s with Rootless mode (Experimental)</a><ul><li><a href="#known-issues-with-rootless-mode" class="table-of-contents__link toc-highlight">Known Issues with Rootless mode</a></li><li><a href="#running-servers-and-agents-with-rootless" class="table-of-contents__link toc-highlight">Running Servers and Agents with Rootless</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li><li><a href="#node-labels-and-taints" class="table-of-contents__link toc-highlight">Node Labels and Taints</a></li><li><a href="#starting-the-server-with-the-installation-script" class="table-of-contents__link toc-highlight">Starting the Server with the Installation Script</a></li><li><a href="#additional-os-preparations" class="table-of-contents__link toc-highlight">Additional OS Preparations</a><ul><li><a href="#additional-preparation-for-debian-buster-based-distributions" class="table-of-contents__link toc-highlight">Additional preparation for Debian &quot;buster&quot; based distributions</a></li><li><a href="#additional-preparation-for-red-hatcentos-enterprise-linux" class="table-of-contents__link toc-highlight">Additional preparation for (Red Hat/CentOS) Enterprise Linux</a></li><li><a href="#additional-preparation-for-raspberry-pi-os" class="table-of-contents__link toc-highlight">Additional preparation for Raspberry Pi OS</a></li></ul></li><li><a href="#enabling-vxlan-for-ubuntu-2110-on-raspberry-pi" class="table-of-contents__link toc-highlight">Enabling vxlan for Ubuntu 21.10+ on Raspberry Pi</a></li><li><a href="#running-k3s-in-docker" class="table-of-contents__link toc-highlight">Running K3s in Docker</a></li><li><a href="#selinux-support" class="table-of-contents__link toc-highlight">SELinux Support</a><ul><li><a href="#automatic-installation" class="table-of-contents__link toc-highlight">Automatic Installation</a></li><li><a href="#manual-installation" class="table-of-contents__link toc-highlight">Manual Installation</a></li><li><a href="#enabling-and-disabling-selinux-enforcement" class="table-of-contents__link toc-highlight">Enabling and Disabling SELinux Enforcement</a></li></ul></li><li><a href="#enabling-lazy-pulling-of-estargz-experimental" class="table-of-contents__link toc-highlight">Enabling Lazy Pulling of eStargz (Experimental)</a><ul><li><a href="#whats-lazy-pulling-and-estargz" class="table-of-contents__link toc-highlight">What&#39;s lazy pulling and eStargz?</a></li><li><a href="#configure-k3s-for-lazy-pulling-of-estargz" class="table-of-contents__link toc-highlight">Configure k3s for lazy pulling of eStargz</a></li></ul></li><li><a href="#additional-logging-sources" class="table-of-contents__link toc-highlight">Additional Logging Sources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.33e19d74.js"></script>
<script src="/docs/assets/js/main.4c2ff82a.js"></script>
</body>
</html>